<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.rainier.nian.dao.MenuDao">
	<insert id="save">
		insert into tb_menu(id,name,mark,url,priority,parentId) 
		values(null,#{name},#{mark},#{url},#{priority},#{parentId})
	</insert>
	
	<delete id="delete" parameterType="int">
		delete from tb_menu where id=#{id}
	</delete>
	
	<select id="findParentMenuByRole" resultType="Menu">
		select distinct * from tb_menu m inner join tb_role_menu rm on rm.menuId=m.id 
		where m.parentId is null and rm.roleId in 
		<foreach collection="roles" item="role" open="(" close=")" separator=",">
			#{role.name}
		</foreach>
		order by priority desc
	</select>
	
	<select id="findOne" resultType="Menu" parameterType="int">
		select * from tb_menu where id=#{id}
	</select>
	
	<select id="getChildldByParentAndRoles" resultType="Menu">
		select distinct * from tb_menu m inner join tb_role_menu rm on rm.menuId=m.id 
		where m.parentId = #{pid} and rm.roleId in 
		<foreach collection="roles" item="role" open="(" close=")" separator=",">
			#{role.name}
		</foreach>
		order by priority desc
	</select>
	
	<select id="findParentMenu" resultType="Menu">
		select distinct * from tb_menu m where m.parentId is null
	</select>
	
	<select id="loadMenuByUrl" resultType="Menu">
		select * from tb_menu m where m.url like concat('%',#{url},'%') order by priority desc
	</select>
	
	<select id="findParentByAjax" resultType="Menu">
		select id,name from tb_menu m where m.parentId is null
	</select>
	
	<select id="findList" resultType="Menu">
		select * from tb_menu order by priority desc limit #{start},#{pageSize}
	</select>
	
	<select id="findAllCount" resultType="long">
		select count(*) from tb_menu
	</select>
	
	<select id="loadMenuByResourceId" resultType="Menu">
		select m.* from tb_menu m inner join tb_resource r on r.menuId=m.id where r.id = #{resourceId}
	</select>
</mapper>