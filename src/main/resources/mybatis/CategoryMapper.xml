<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.brightengold.dao.CategoryDao">
	<resultMap type="Category" id="CategoryMap">
		<id column="id" property="id" jdbcType="INTEGER"/>
		<result column="name" property="name" jdbcType="VARCHAR"/>
		<result column="enName" property="enName" jdbcType="VARCHAR"/>
		<result column="parentId" property="parentId" jdbcType="INTEGER"/>
		<result column="createDate" property="createDate" jdbcType="TIMESTAMP"/>
		<result column="createUserId" property="createUserId" jdbcType="INTEGER"/>
		<result column="columnId" property="columnId" jdbcType="INTEGER"/>
		<result column="remark" property="remark" jdbcType="VARCHAR"/>
		
		<result column="parentName" property="parentName" jdbcType="VARCHAR"/>
		<result column="columnName" property="columnName" jdbcType="VARCHAR"/>
	</resultMap>
	<select id="findParentByAjax" resultType="Category">
		select c.id,c.enName from tb_category c where c.parentId is null order by c.createDate asc
	</select>
	
	<select id="loadCateByName" resultType="Category" parameterType="java.lang.String">
		select * from tb_category c where c.enName = #{enName}
	</select>
	
	<select id="checkHasChildren" resultType="long" parameterType="int">
		select count(id) from tb_category c where c.parentId = #{categoryId}
	</select>
	
	<select id="findCate" resultType="Category" parameterType="int">
		select * from tb_category c where c.columnId = #{colId} order by c.createDate asc
	</select>
	
	<select id="findAllParentCateList" resultType="Category">
		select * from tb_category c where c.parentId is null order by c.createDate asc
	</select>
	
	<select id="findChildrenByParentCateId" resultType="Category" parameterType="int">
		select c.id,c.enName from tb_category c where c.parentId = #{parentCateId} order by c.createDate asc
	</select>
	
	<!-- 后台系统展示 -->
	<select id="findAllCount" resultType="long">
		select count(*) from tb_category c  
	</select>
	
	<select id="findList" resultMap="CategoryMap">
		select c1.*,t2.name as parentName,tc.name as columnName from tb_category c1 inner join tb_category c2 
		on c1.parentId=c2.id inner join tb_column tc on c1.columnId=tc.id 
		order by c1.createDate desc limit #{start},#{pageSize}
	</select>
	
	<select id="findOneById" parameterType="int" resultType="Category">
		select * from tb_category where id=#{categoryId}
	</select>
	
	<insert id="save">
		insert into tb_category(id,name,enName,parentId,createDate,createUserId,columnId,remark) 
		values(null,#{name},#{enName},#{parentId},#{createDate},#{createUserId},#{columnId},#{remark})
	</insert>
	
	<delete id="delete" parameterType="int">
		delete from tb_category where id=#{id}
	</delete>
	
	<select id="countByEname" resultType="long">
		select count(*) from tb_category where enName=#{enName}
	</select>
	
	<select id="findOneByEnName" parameterType="java.lang.String" resultType="Category">
		select * from tb_category where enName=#{enName}
	</select>
	
	<!-- 生成页面使用 -->
	<select id="findAll" resultType="Category">
		select * from tb_category order by c.createDate desc
	</select>
	
</mapper>